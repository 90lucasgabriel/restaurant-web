<div *ngIf="loading">
  <mat-progress-spinner mode="indeterminate" diameter="30" strokeWidth="4"></mat-progress-spinner>
</div>
  
<div [ngClass]="{'container-flex':true, 'flex-center': true}">
  <!-- BACK AND TITLE START -->
  <div class="mat-typography container-flex header-page content-page">
    <div class="flex-5"><button mat-icon-button><mat-icon>store</mat-icon></button></div>
    <div class="flex-65 text-title">Filiais</div>
    <div class="flex-30 text-right">
      <mat-form-field *ngIf="false">
        <mat-icon matSuffix>search</mat-icon>
        <input matInput placeholder="Pesquisar" [(ngModel)]="search" name="search" (keyup)="applyFilter()">
        <button mat-button *ngIf="search" matPrefix mat-icon-button aria-label="Clear" (click)="applyFilter(''); search=''">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
      <button mat-icon-button (click)="showFilter = !showFilter" matTooltip="Filtrar"><mat-icon>filter_list</mat-icon></button>
      <button mat-icon-button (click)="deleteConfirm(row)" matTooltip="Exportar"><mat-icon>share</mat-icon></button>
    </div>  
  </div>
  <!--BACK AND TITLE END -->

  <!-- FILTER START -->
  <div class="flex container-flex content-page margin-bottom" *ngIf="showFilter">
    <div class="flex-20 margin-right">
      <mat-form-field class="full-width">
        <input matInput placeholder="Endereço" [(ngModel)]="filter.address" name="filter.address" (keyup)="applyFilter()">
      </mat-form-field>
    </div>
    <div class="flex-20 margin-right">
      <mat-form-field class="full-width">
        <input matInput placeholder="Número" [(ngModel)]="filter.number" name="filter.number" (keyup)="applyFilter()">
      </mat-form-field>
    </div>
    <div class="flex-20 margin-right">
      <mat-form-field class="full-width">
        <input matInput placeholder="Cidade" [(ngModel)]="filter.city" name="filter.city" (keyup)="applyFilter()">
      </mat-form-field>
    </div>
    <div class="flex-20 margin-right">
      <mat-form-field class="full-width">
        <input matInput placeholder="UF" [(ngModel)]="filter.state" name="filter.state" (keyup)="applyFilter()">
      </mat-form-field>
    </div>
    <div class="flex-20 margin-right">
      <mat-form-field class="full-width">
        <input matInput placeholder="Telefone" [(ngModel)]="filter.phone_1" name="filter.phone_1" (keyup)="applyFilter()">
      </mat-form-field>
    </div>
  </div>
  <!-- FILTER END -->

  <div class="flex content-page">
    <div #table class="full-width" matSort matSortActive="id" matSortDirection="desc"> 
      <div class="flex mat-typography padding flex-center container-flex content-page text-center">
        <div class="flex-10" mat-sort-header="id">ID</div>
        <div class="flex-10" mat-sort-header="address">Endereço</div>
        <div class="flex-10" mat-sort-header="number">Número</div>
        <div class="flex-10" mat-sort-header="city">Cidade</div>
        <div class="flex-10" mat-sort-header="state">Estado</div>
        <div class="flex-10" mat-sort-header="phone_1">Telefone</div>
      </div>
      <div>
        <mat-accordion>
        <mat-expansion-panel *ngFor="let item of dataSource.data">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <div class="flex-10">{{item.id}}</div>
              <div class="flex-90">{{item.address}}</div>
            </mat-panel-title>
          </mat-expansion-panel-header>        
          <div class="flex-container text-right">
            <button mat-icon-button *ngIf="!editMode" (click)="editMode=true" matTooltip="Editar"> <mat-icon>edit</mat-icon></button>
            <button mat-icon-button *ngIf="editMode" (click)="editMode=false" matTooltip="Salvar"> <mat-icon>save</mat-icon></button>
          </div>
          <!-- DETAILS START -->
          <div *ngIf="!editMode">
            <mat-card-title-group>
              <mat-card-subtitle>Localização</mat-card-subtitle>
            </mat-card-title-group>
            <div class="container-flex margin-bottom">
              <div class="flex-5 align-top">
                <p><mat-icon>place</mat-icon></p>
              </div>
              <div class="flex-95">
              <div class="container-flex">
                <div class="flex-10"><p>CEP: </p></div>
                <div class="flex-90"><p>{{item.zipcode}}</p></div>
              </div>
              <div class="container-flex">
                <div class="flex-10"><p>Endereço: </p></div>
                <div class="flex-40"><p>{{item.address}}</p></div>
                <div class="flex-10"><p>Número: </p></div>
                <div class="flex-40"><p>{{item.number}}</p></div>
              </div>
              <div class="container-flex">
                <div class="flex-10"><p>Complemento: </p></div>
                <div class="flex-40"><p>{{item.complement}}</p></div>
                <div class="flex-10"><p>Bairro: </p></div>
                <div class="flex-40"><p>{{item.neighborhood}}</p></div>
              </div>
              <div class="container-flex">
                <div class="flex-10"><p>Cidade: </p></div>
                <div class="flex-40"><p>{{item.city}}</p></div>
                <div class="flex-10"><p>Estado: </p></div>
                <div class="flex-40"><p>{{item.state}}</p></div>
              </div>
            </div>
          </div>
    
            <mat-card-title-group>
              <mat-card-title></mat-card-title>
              <mat-card-subtitle>Contato</mat-card-subtitle>
            </mat-card-title-group>
            <div class="container-flex margin-bottom">
              <div class="flex-5 align-top">
                <p><mat-icon>email</mat-icon></p>
              </div>
              <div class="flex-95">
                <div class="container-flex">
                  <div class="flex-10"><p>Email 1: </p></div>
                  <div class="flex-40"><p>{{item.email_1}}</p></div>
                  <div class="flex-10"><p>Email 2: </p></div>
                  <div class="flex-40"><p>{{item.email_2}}</p></div>
                </div>
                <div class="container-flex">
                  <div class="flex-10"><p>Telefone 1: </p></div>
                  <div class="flex-40"><p>{{item.phone_1}}</p></div>
                  <div class="flex-10"><p>Telefone 2: </p></div>
                  <div class="flex-40"><p>{{item.phone_2}}</p></div>
                </div>
              </div>
            </div>
    
            <mat-card-title-group>
              <mat-card-title></mat-card-title>
              <mat-card-subtitle>Redes Sociais</mat-card-subtitle>
            </mat-card-title-group>
            <div class="container-flex">
              <div class="flex-5 align-top">
                <p><mat-icon>link</mat-icon></p>
              </div>
              <div class="flex-95">
                <div class="container-flex">
                  <div class="flex-10"><p>Site: </p></div>
                  <div class="flex-90"><p>{{item.website}}</p></div>
                </div>
                <div class="container-flex">
                  <div class="flex-10"><p>Facebook: </p></div>
                  <div class="flex-90"><p>{{item.facebook}}</p></div>
                </div>
                <div class="container-flex">
                  <div class="flex-10"><p>Twitter: </p></div>
                  <div class="flex-90"><p>{{item.twitter}}</p></div>
                </div>
                <div class="container-flex">
                  <div class="flex-10"><p>Instagram: </p></div>
                  <div class="flex-90"><p>{{item.instagram}}</p></div>
                </div>
              </div>
            </div>
          </div>
          <!-- DETAILS END -->
          <!-- CREATE AND EDIT FORM START -->
          <div *ngIf="editMode">

          
      <form #itemForm="ngForm">
          <mat-card-title-group>
            <mat-card-subtitle>Localização</mat-card-subtitle>
          </mat-card-title-group>
          <div class="container-flex margin-bottom">
            <div class="flex-5 align-top">
              <p><mat-icon>place</mat-icon></p>
            </div>
            <div class="flex-95">
              <div class="container-flex">
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="CEP" [(ngModel)]="item.zipcode" name="zipcode" required>
                  </mat-form-field>
                </div>
              </div>
              <div class="container-flex">
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Endereço" [(ngModel)]="item.address" name="address" required>
                  </mat-form-field>
                </div>
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Número" [(ngModel)]="item.number" name="number" required>
                  </mat-form-field>
                </div>
              </div>
              <div class="container-flex">
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Complemento" [(ngModel)]="item.complement" name="complement">
                  </mat-form-field>
                </div>
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Bairro" [(ngModel)]="item.neighborhood" name="neighborhood" required>
                  </mat-form-field>
                </div>
              </div>
              <div class="container-flex">
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Cidade" [(ngModel)]="item.city" name="city" required>
                  </mat-form-field>
                </div>
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Estado" [(ngModel)]="item.state" name="state" required>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
  
          <mat-card-title-group>
            <mat-card-title></mat-card-title>
            <mat-card-subtitle>Contato</mat-card-subtitle>
          </mat-card-title-group>
          <div class="container-flex margin-bottom">
            <div class="flex-5 align-top">
              <p><mat-icon>email</mat-icon></p>
            </div>
            <div class="flex-95">
              <div class="container-flex">
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Email 1" [(ngModel)]="item.email_1" name="email_1" required>
                  </mat-form-field>
                </div>
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Email 2" [(ngModel)]="item.email_2" name="email_2">
                  </mat-form-field>
                </div>
              </div>
              <div class="container-flex">
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Telefone 1" [(ngModel)]="item.phone_1" name="phone_1" required>
                  </mat-form-field>
                </div>
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Telefone 2" [(ngModel)]="item.phone_2" name="phone_2">
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
  
          <mat-card-title-group>
            <mat-card-title></mat-card-title>
            <mat-card-subtitle>Redes Sociais</mat-card-subtitle>
          </mat-card-title-group>
          <div class="container-flex margin-bottom">
            <div class="flex-5 align-top">
              <p><mat-icon>link</mat-icon></p>
            </div>
            <div class="flex-95">
              <div class="container-flex">
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Site" [(ngModel)]="item.website" name="website">
                  </mat-form-field>
                </div>
              </div>
              <div class="container-flex">
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Facebook" [(ngModel)]="item.facebook" name="facebook">
                  </mat-form-field>
                </div>
              </div>
              <div class="container-flex">
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Twitter" [(ngModel)]="item.twitter" name="twitter">
                  </mat-form-field>
                </div>
              </div>
              <div class="container-flex">
                <div class="flex-10 margin-right">
                  <mat-form-field class="full-width">
                    <input matInput placeholder="Instagram" [(ngModel)]="item.instagram" name="instagram">
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </form>
        <button mat-button (click)="editMode = false">CANCELAR</button>
        <button mat-button (click)="submitForm(item)" [disabled]="!itemForm.form.valid" color="primary">SALVAR</button>
        <!-- EDIT FORM END -->
      </div>
        </mat-expansion-panel>
      </mat-accordion>
      </div>
    </div>
    <mat-paginator [length]="total" [pageSize]="20" [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
  </div>

  <!-- LIST START -->
  <div class="flex content-page" *ngIf="false">      
    <div class="flex full-width mat-elevation-z4">
      <div style="display: none" class="loading-shade full-width" *ngIf="(loadingResults || timeout)">
        <mat-spinner *ngIf="loadingResults" mode="indeterminate" diameter="40" strokeWidth="5" style="padding: 0"></mat-spinner>
        <div *ngIf="timeout" class="mat-typography text-center">
          <div><mat-icon style="font-size: 50px">sync_problem</mat-icon></div>
          <div>Não foi possível executar a ação. Tente novamente mais tarde.</div>
        </div>
      </div>
    
      <mat-table #table [dataSource]="dataSource" class="example-table"
        matSort matSortActive="id" matSortDirection="desc">    
        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <mat-header-cell *matHeaderCellDef mat-sort-header class="id-column"> ID </mat-header-cell>
          <mat-cell *matCellDef="let row" class="id-column"  [routerLink]="['/company', row.company.data.id, 'branch', row.id]"> {{row.id}} </mat-cell>
        </ng-container>
    
        <!-- Address Column -->
        <ng-container matColumnDef="address">
          <mat-header-cell *matHeaderCellDef mat-sort-header> Endereço </mat-header-cell>
          <mat-cell *matCellDef="let row" [routerLink]="['/company', row.company.data.id, 'branch', row.id]"> {{row.address}} </mat-cell>
        </ng-container>

        <!-- Number Column -->
        <ng-container matColumnDef="number">
          <mat-header-cell *matHeaderCellDef mat-sort-header  class="number-column"> Número </mat-header-cell>
          <mat-cell *matCellDef="let row"  class="number-column" [routerLink]="['/company', row.company.data.id, 'branch', row.id]"> {{row.number}} </mat-cell>
        </ng-container>
    
        <!-- City Column -->
        <ng-container matColumnDef="city">
          <mat-header-cell *matHeaderCellDef mat-sort-header> Cidade </mat-header-cell>
          <mat-cell *matCellDef="let row" [routerLink]="['/company', row.company.data.id, 'branch', row.id]"> {{row.city}} </mat-cell>
        </ng-container>

        <!-- State Column -->
        <ng-container matColumnDef="state">
          <mat-header-cell *matHeaderCellDef mat-sort-header> UF </mat-header-cell>
          <mat-cell *matCellDef="let row" [routerLink]="['/company', row.company.data.id, 'branch', row.id]"> {{row.state}} </mat-cell>
        </ng-container>

        <!-- Phone Column -->
        <ng-container matColumnDef="phone_1">
          <mat-header-cell *matHeaderCellDef mat-sort-header> Telefone </mat-header-cell>
          <mat-cell *matCellDef="let row" [routerLink]="['/company', row.company.data.id, 'branch', row.id]"> {{row.phone_1}} </mat-cell>
        </ng-container>

        <!-- Phone Column -->
        <ng-container matColumnDef="actions">
          <mat-header-cell *matHeaderCellDef class="actions-column"></mat-header-cell>
          <mat-cell *matCellDef="let row" class="hover-child actions-column">
              <button *ngIf="false" mat-icon-button [routerLink]="['/company', row.company.data.id, 'branch', row.id]" matTooltip="Detalhes"><mat-icon>search</mat-icon></button>
              <button mat-icon-button [routerLink]="[row.id, 'edit']" matTooltip="Editar"><mat-icon>edit</mat-icon></button>
              <button mat-icon-button (click)="deleteConfirm(row)" matTooltip="Excluir"><mat-icon>delete</mat-icon></button>
          </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="columns"></mat-header-row>
        <mat-row class="hover-parent pointer" *matRowDef="let row; columns: columns;"></mat-row>
      </mat-table>
    
      <mat-paginator [length]="total" [pageSize]="20" [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
    </div>
  </div>
  <!-- LIST END -->


  <div class="fab-position">
    <button mat-fab [routerLink]="['new']" matTooltip="Novo" matTooltipPosition="left"><mat-icon>add</mat-icon></button>
  </div>
</div>
